<!DOCTYPE html>
<html lang="en">
<head>
<title>
Converting Conditional Build Steps to Jenkins Pipeline
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Converting Conditional Build Steps to Jenkins Pipeline" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Converting Conditional Build Steps to Jenkins Pipeline" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="https://zbynek.github.io/jenkins.io/order-syntax/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Converting Conditional Build Steps to Jenkins Pipeline" property="og:title">
<meta content="article" property="og:type">
<meta content="https://zbynek.github.io/jenkins.io/order-syntax/blog/2017/01/19/converting-conditional-to-pipeline/index.html" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Converting Conditional Build Steps to Jenkins Pipeline" property="og:site_name">
<meta content="https://zbynek.github.io/jenkins.io/order-syntax/images/logo-title-opengraph.png" name="og:image">
<link href="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/tether/css/tether.min.css" media="screen" rel="stylesheet">
<link href="https://zbynek.github.io/jenkins.io/order-syntax/css/font-icons.css" media="screen" rel="stylesheet">
<link href="https://zbynek.github.io/jenkins.io/order-syntax/css/jenkins.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/ionicons/css/ionicons.min.css" media="screen" rel="stylesheet">
<link href="https://zbynek.github.io/jenkins.io/order-syntax/css/footer.css" media="screen" rel="stylesheet">
<link href="https://zbynek.github.io/jenkins.io/order-syntax/css/font-awesome.min.css" media="screen" rel="stylesheet">
</head>
<body>
<script src="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<nav class="navbar navbar-expand-lg navbar-dark top bg-dark fixed-top" id="ji-toolbar">
<a class="navbar-brand" href="https://zbynek.github.io/jenkins.io/order-syntax">
Jenkins
</a>
<button class="navbar-toggler" data-target="#CollapsingNavbar" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="CollapsingNavbar">
<ul class="nav navbar-nav mr-auto">
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
<!-- starting partial cdf_logo.html.haml -->
<svg width="36" height="18" xmlns="http://www.w3.org/2000/svg" role="img" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-3.23 44.77 362.70 271.95"><defs><linearGradient id="a" x1="359.765" x2="104.082" y1="134.295" y2="124.577" gradientTransform="matrix(1 0 0 -1 0 439.068)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ed1c24"/><stop offset="1" stop-color="#f7941d"/></linearGradient><linearGradient id="b" x1="355.202" x2="99.519" y1="254.467" y2="244.749" xlink:href="#a"/><linearGradient id="c" x1="183.903" x2="10.612" y1="227.598" y2="221.023" xlink:href="#a"/><linearGradient id="d" x1="367.119" x2="157.995" y1="265.311" y2="257.091" xlink:href="#a"/></defs><path fill="#c49a6c" d="M231.52 309.278c2.483-.332 4.895-.77 7.255-1.329s4.649-1.206 6.991-1.957c13.494-4.58 25.187-12.952 36.374-24.593l-.14-.175c-14.944 15.486-30.693 25.344-50.48 28.054z"/><path fill="url(#a)" d="M224.232 309.96h.332c1.084 0 2.15-.14 3.216-.228a93.844 93.844 0 0 1-3.233.227z"/><path fill="url(#b)" d="M284.692 187.187l-.122.192.122-.192z"/><path fill="url(#c)" d="M146.145 231.847a150.844 150.844 0 0 1-12.97 15.862c-7.582 7.889-15.507 13.563-24.652 16.667a47.832 47.832 0 0 1-4.738 1.326 56.959 56.959 0 0 1-4.916.9 38.32 38.32 0 0 1-1.682.214l-.912.083c-.723.059-1.445.118-2.18.154h-3.068a42.325 42.325 0 0 1-9.192-1.043 49.977 49.977 0 0 1-6.764-2.002 43.097 43.097 0 0 1-4.525-1.954c-1.493-.77-2.961-1.516-4.407-2.37a59.5 59.5 0 0 1-17.105-15.399 59.714 59.714 0 0 1-2.914-4.311 53.09 53.09 0 0 1-1.291-2.263 51.985 51.985 0 0 1-2.263-4.738 46.72 46.72 0 0 1 0-36.426 51.986 51.986 0 0 1 2.263-4.738 54.14 54.14 0 0 1 1.291-2.263 59.742 59.742 0 0 1 2.914-4.311 59.714 59.714 0 0 1 17.105-15.4 60.828 60.828 0 0 1 4.407-2.369q2.217-1 4.525-1.777a49.976 49.976 0 0 1 6.906-2.073 42.325 42.325 0 0 1 9.192-1.042h3.128c.722 0 1.445.094 2.155.154l1.043.106 1.019.119c1.8.237 3.553.557 5.271.96.853.2 1.694.426 2.523.663a51.186 51.186 0 0 1 11.846 5.176 59.645 59.645 0 0 1 4.395 2.89 74.485 74.485 0 0 1 8.386 7.108q2.038 1.99 4.063 4.193l.083-.13a159.395 159.395 0 0 1 11.064 13.942c5.437-8.576 13.658-21.464 16.584-25.74 1.185-1.718 2.37-3.46 3.66-5.212-13.54-16.513-29.827-30.23-51.587-36.082h-.154a89.397 89.397 0 0 0-3.187-.794l-.45-.107a92.565 92.565 0 0 0-3.151-.627l-.628-.119a80.578 80.578 0 0 0-3.743-.569h-.142a58.29 58.29 0 0 0-2.073-.236h-.391l-1.872-.166h-.568l-1.754-.119h-.675l-1.777-.07h-3.115c-46.447-.25-87.125 40.476-87.125 86.911s40.725 87.173 87.172 87.173h3.14l1.729-.071h.734l1.67-.095h.676l1.706-.154h.568l1.813-.213.414-.06 1.967-.272h.213a125.91 125.91 0 0 0 3.553-.628l.652-.142c.96-.201 1.907-.415 2.855-.64l.58-.142a86.66 86.66 0 0 0 3.009-.817l.237-.071c20.73-6.077 36.425-19.392 49.55-35.277-2.037-3.068-3.4-5.366-4.039-6.48z"/><path fill="url(#d)" d="M318.05 51.733v94.66a85.514 85.514 0 0 0-52.595-18.729h-3.115l-1.777.072-.7.047-1.752.118h-.569l-1.871.166h-.391c-.7.071-1.386.142-2.073.237h-.154c-1.256.154-2.5.355-3.732.569l-.628.118c-1.066.19-2.108.403-3.15.628l-.45.107c-30.35 6.858-50.333 28.808-66.822 52.82-.7 1.018-1.35 2.049-2.038 3.068-2.25 3.423-5.46 8.422-8.635 13.397-4.17 6.527-8.292 13.03-9.939 15.66l20.624 32.137s21.997 40.465 61.68 51.482l.237.07c.995.297 2.002.558 3.009.818l.58.142c.936.237 1.896.439 2.855.64l.652.142c1.184.225 2.369.439 3.553.628h.214l1.966.273.415.059 1.812.213h.569l1.705.154h.676l1.67.095h.734l1.73.07h3.139c54.703 0 86.355-30.964 87.149-85.063V51.733zm-52.595 215.403h-3.068c-.734 0-1.457-.095-2.18-.154l-.912-.083c-.568-.06-1.125-.13-1.682-.213a49.077 49.077 0 0 1-9.571-2.275 49.612 49.612 0 0 1-6.634-2.83 55.792 55.792 0 0 1-6.254-3.768 63.068 63.068 0 0 1-3.009-2.215 82.399 82.399 0 0 1-8.683-7.925l-.095.119c-1.255-1.303-2.487-2.69-3.731-4.11-.154-.167-.296-.356-.45-.534-.628-.722-1.256-1.445-1.884-2.215s-1.125-1.398-1.682-2.097-.888-1.101-1.338-1.682a184.467 184.467 0 0 1-6.053-8.292c-.7-.995-1.398-2.025-2.109-3.056-.379-.569-.77-1.184-1.185-1.73-.675-1.018-1.362-2.013-2.049-3.056l-.355-.545c-1.185-1.812-2.37-3.684-3.649-5.603q2.95-4.608 5.817-8.86c1.907-2.831 3.79-5.556 5.662-8.138s3.72-5.046 5.591-7.38 3.72-4.525 5.603-6.586q2.026-2.203 4.063-4.194c1.374-1.338 2.748-2.594 4.158-3.778s2.807-2.287 4.252-3.329a57.594 57.594 0 0 1 7.748-4.62c.331-.166.663-.367 1.006-.533l.226-.118c1.41-.652 2.843-1.185 4.3-1.73l.485-.201c.273-.083.557-.142.83-.237a44.943 44.943 0 0 1 3.34-.948l1.374-.343a60.798 60.798 0 0 1 4.738-.841l1.019-.119 1.042-.106c.711 0 1.434-.119 2.156-.154h3.128a42.431 42.431 0 0 1 4.572.26 48.011 48.011 0 0 1 6.93 1.35c1.54.427 3.08.925 4.596 1.505a48.724 48.724 0 0 1 4.525 1.955c1.493.722 2.961 1.516 4.407 2.369s2.866 1.8 4.24 2.784 2.725 2.049 4.028 3.174a58.459 58.459 0 0 1 8.837 9.477 59.73 59.73 0 0 1 2.914 4.312 51.067 51.067 0 0 1 5.318 11.916 47.38 47.38 0 0 1 1.185 5.165 45.567 45.567 0 0 1 .71 8.09c.072 35.964-16.062 52.122-52.227 52.122z"/></svg>

<!-- ending partial cdf_logo.html.haml -->
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://cd.foundation/">
What is CDF?
</a>
<a class="dropdown-item feature" href="https://jenkins-x.io/">
Jenkins X
</a>
<a class="dropdown-item feature" href="https://cloud.google.com/tekton/">
Tekton
</a>
<a class="dropdown-item feature" href="https://www.spinnaker.io/">
Spinnaker
</a>
</div>
</li>
</ul>
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node">
Blog
</a>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Documentation
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/doc">
Use Jenkins
</a>
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/doc/developer">
Extend Jenkins
</a>
<span class="dropdown-item">
<strong>
Use-cases
</strong>
</span>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/android">
&nbsp;-&nbsp;Android
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/c">
&nbsp;-&nbsp;C/C++
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/docker">
&nbsp;-&nbsp;Docker
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/embedded">
&nbsp;-&nbsp;Embedded
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/github">
&nbsp;-&nbsp;GitHub
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/java">
&nbsp;-&nbsp;Java
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/php">
&nbsp;-&nbsp;PHP
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/pipeline">
&nbsp;-&nbsp;Continuous Delivery
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/python">
&nbsp;-&nbsp;Python
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/ruby">
&nbsp;-&nbsp;Ruby
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://plugins.jenkins.io/">
Plugins
</a>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Community
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/participate">
Overview
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/chat" title="Chat with the rest of the Jenkins community on IRC">
Chat
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/jam">
Meet
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/events">
Events
</a>
<a class="dropdown-item feature" href="https://issues.jenkins-ci.org/">
Issue Tracker
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/mailing-lists" title="Browse Jenkins mailing list archives and/or subscribe to lists">
Mailing Lists
</a>
<a class="dropdown-item feature" href="https://wiki.jenkins.io/">
Wiki
</a>
<a class="dropdown-item feature" href="https://accounts.jenkins.io/" title="Create/manage your account for accessing wiki, issue tracker, etc">
Account Management
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/">
<strong>
Special Interest Groups
</strong>
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/advocacy-and-outreach/">
&nbsp;-&nbsp;Advocacy and Outreach
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/chinese-localization/">
&nbsp;-&nbsp;Chinese Localization
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/cloud-native/">
&nbsp;-&nbsp;Cloud Native
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/docs/">
&nbsp;-&nbsp;Documentation
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/gsoc/">
&nbsp;-&nbsp;Google Summer of Code
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/hw-and-eda/">
&nbsp;-&nbsp;Hardware and EDA
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/pipeline-authoring/">
&nbsp;-&nbsp;Pipeline Authoring
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/platform/">
&nbsp;-&nbsp;Platform
</a>
</div>
</li>
<li class="dropdown nav-item">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Subprojects
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/">
Overview
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/blueocean/">
Blue Ocean
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/evergreen/">
Evergreen
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/gsoc/">
Google Summer of Code in Jenkins
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/infrastructure/">
Infrastructure
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/jam/">
Jenkins Area Meetups
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/jcasc/">
Jenkins Configuration as Code
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/remoting/">
Jenkins Remoting
</a>
</div>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
About
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/security">
Security
</a>
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/press">
Press
</a>
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/awards">
Awards
</a>
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/project/conduct">
Conduct
</a>
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/artwork">
Artwork
</a>
</div>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
English
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/zh">
中文 Chinese
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link btn btn-outline-secondary" href="https://zbynek.github.io/jenkins.io/order-syntax/download">
Download
</a>
</li>
</ul>
</div>
</nav>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<script>
  $(function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('#content h' + i);
    }
  })
</script>
<div class="container blog-post">
<div class="row body">
<div class="col-md-11 col-md-offset-1 main-content" id="content">
<div id="content-top">
<h1>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/blog/2017/01/19/converting-conditional-to-pipeline/" title="Converting Conditional Build Steps to Jenkins Pipeline">
Converting Conditional Build Steps to Jenkins Pipeline
</a>
</h1>
<div style="float: right; clear: all;">
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/share">
Tweet
</a>
</div>
<div class="post-attrs">
<span class="submitted">
Published on
2017-01-19
by
<a href="/blog/authors/lnewman">Liam Newman</a>
</span>
<ul class="list-inline tags">
<li>
<a class="tag-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node/tags/pipeline">
pipeline
</a>
</li>
<li>
<a class="tag-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node/tags/freestyle">
freestyle
</a>
</li>
<li>
<a class="tag-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node/tags/plugins">
plugins
</a>
</li>
<li>
<a class="tag-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node/tags/conditional-build-step">
conditional-build-step
</a>
</li>
<li>
<a class="tag-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node/tags/tutorial">
tutorial
</a>
</li>
</ul>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is a guest post by <a href="https://github.com/bitwiseman">Liam Newman</a>,
Technical Evangelist at <a href="https://cloudbees.com">CloudBees</a>.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With all the new developments in
<a href="/doc/book/pipeline/">Jenkins Pipeline</a> (and
<a href="/blog/2017/01/12/declarative-pipeline-beta-2/">Declarative Pipeline on the horizon</a>),
it&#8217;s easy to forget what we did to create "pipelines" before
<strong>Pipeline</strong>.
There are number of plugins, some that have been around since the very beginning,
that enable users to create "pipelines" in Jenkins.
For example, basic job chaining worked well in many cases, and the
<a href="https://plugins.jenkins.io/parameterized-trigger">Parameterized Trigger plugin</a>
made chaining more flexible.
However, creating chained jobs with conditional behavior was
still one of the harder things to do in Jenkins.</p>
</div>
<div class="paragraph">
<p>The
<a href="https://plugins.jenkins.io/conditional-buildstep">Conditional BuildStep plugin</a>
is a powerful tool that has allowed Jenkins users to write Jenkins jobs with complex conditional logic.
In this post, we&#8217;ll take a look at how we might converting Freestyle jobs that
include conditional build steps to Jenkins Pipeline.
Unlike Freestyle jobs, implementing conditional operations in Jenkins Pipeline is trivial,
but matching the behavior of complex conditional build steps will require a bit more care.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="graphical-programming"><a class="anchor" href="#graphical-programming"></a>Graphical Programming</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Conditional BuildStep plugin lets users add conditional logic to Freestyle
jobs from within the Jenkins web UI.  It does this by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding two types of Conditional BuildStep ("Single" and "Multiple") -
these build steps contain one or more other build steps to be run when the configured
condition is met</p>
</li>
<li>
<p>Adding a set of Condition operations -
these control whether the Conditional BuildStep execute the contained step(s)</p>
</li>
<li>
<p>Leveraging the Token Macro facility -
these provide values to the Conditions for evaluation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the example below, this project will run the shell script step when the value of the
<code>REQUESTED_ACTION</code> token equals "greeting".</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="/images/post-images/2017-01-19/freestyle-conditional-param.png" alt="Freestyle Job Parameters" width="800">
</div>
</div>
<div class="imageblock center">
<div class="content">
<img src="/images/post-images/2017-01-19/freestyle-conditional-config.png" alt="Freestyle Job Conditional BuildStep" width="800">
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the output when I run this project with <code>REQUESTED_ACTION</code> set to "greeting":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>Run condition [Strings match] enabling prebuild for step [Execute shell]
Strings match run condition: string 1=[greeting], string 2=[greeting]
Run condition [Strings match] enabling perform for step [Execute shell]
[freestyle-conditional] $ /bin/sh -xe /var/folders/hp/f7yc_mwj2tq1hmbv_5n10v2c0000gn/T/hudson5963233933358491209.sh
+ echo 'Hello, bitwiseman!'
Hello, bitwiseman!
Finished: SUCCESS</code></pre>
</div>
</div>
<div class="paragraph">
<p>And when I pass the value "silence":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>Run condition [Strings match] enabling prebuild for step [Execute shell]
Strings match run condition: string 1=[silence], string 2=[greeting]
Run condition [Strings match] preventing perform for step [Execute shell]
Finished: SUCCESS</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a simple example but the conditional step can contain any regular build step.
When combined with other plugins, it can control whether to send notifications,
gather data from other sources, wait for user feedback, or call other projects.</p>
</div>
<div class="paragraph">
<p>The Conditional BuildStep plugin does a great job of leveraging strengths of
the Jenkins web UI, Freestyle jobs, and UI-based programming,
but it is also hampered by their limitations.
The Jenkins web UI can be clunky and confusing at times.
Like the steps in any Freestyle job, these conditional steps are only
stored and viewable in Jenkins.
They are not versioned with other product or build code and can&#8217;t be code reviewed.
Like any number of UI-based programming tools, it has to make trade-offs between clarity
and flexibility: more options or clearer presentation.
There&#8217;s only so much space on the screen.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="converting-to-pipeline"><a class="anchor" href="#converting-to-pipeline"></a>Converting to Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jenkins Pipeline, on the other hand, enables users to implement their pipeline as code.
Pipeline code can be written directly in the Jenkins Web UI or in any text editor.
It is a full-featured programming language,
which gives users access to much broader set of conditional statements
without the restrictions of UI-based programming.</p>
</div>
<div class="paragraph">
<p>So, taking the example above, the Pipeline equivalent is:</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-declarative">
    <div class="title">Jenkinsfile (Declarative Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">pipeline {
    agent any
    parameters {
        choice(
            <span style="color:#606">choices</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">greeting</span><span style="color:#710">'</span></span> , <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">silence</span><span style="color:#710">'</span></span>],
            <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>,
            <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">REQUESTED_ACTION</span><span style="color:#710">'</span></span>)
    }

    stages {
        stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Speak</span><span style="color:#710">'</span></span>) {
            when {
                <span style="color:#777">// Only say hello if a &quot;greeting&quot; is requested</span>
                expression { params.REQUESTED_ACTION == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">greeting</span><span style="color:#710">'</span></span> }
            }
            steps {
                echo <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello, bitwiseman!</span><span style="color:#710">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div></div>  <div class="pipeline-script-expand">
    <a href="#" onclick="javascript:$(this).parent().siblings('.pipeline-script').toggle(); return false;">Toggle Scripted Pipeline</a>
    <em>(Advanced)</em>
  </div>
  <div class="listingblock pipeline-script"
        style="display: none">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">properties ([
    parameters ([
        choice (
            <span style="color:#606">choices</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">greeting</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">silence</span><span style="color:#710">'</span></span>],
            <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>,
            name : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">REQUESTED_ACTION</span><span style="color:#710">'</span></span>)
    ])
])

node {
    stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Speak</span><span style="color:#710">'</span></span>) {
        <span style="color:#777">// Only say hello if a &quot;greeting&quot; is requested</span>
        <span style="color:#080;font-weight:bold">if</span> (params.REQUESTED_ACTION == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">greeting</span><span style="color:#710">'</span></span>) {
            echo <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello, bitwiseman!</span><span style="color:#710">&quot;</span></span>
        }
    }
}</code></pre>
</div></div></div>
<div class="paragraph">
<p>When I run this project with <code>REQUESTED_ACTION</code> set to "greeting", here&#8217;s the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[Pipeline] node
Running on osx_mbp in /Users/bitwiseman/jenkins/agents/osx_mbp/workspace/pipeline-conditional
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Speak)
[Pipeline] echo
Hello, bitwiseman!
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS</code></pre>
</div>
</div>
<div class="paragraph">
<p>When I pass the value "silence", the only change is "Hello, bitwiseman!" is not printed.</p>
</div>
<div class="paragraph">
<p>Some might argue that the Pipeline code is a bit harder to understand on first reading.
Others would say the UI is just as confusing if not more so.
Either way, the Pipeline representation is considerably more compact than the Jenkins UI presentation.
Pipeline also lets us add helpful comments, which we can&#8217;t do in the Freestyle UI.
And we can easily put this Pipeline in a <code>Jenkinsfile</code> to be code-reviewed, checked-in, and versioned
along with the rest of our code.</p>
</div>
<div class="sect2">
<h3 id="conditions"><a class="anchor" href="#conditions"></a>Conditions</h3>
<div class="paragraph">
<p>The previous example showed the "Strings match" condition and its Pipeline equivalent.
Let&#8217;s look at couple more interesting conditions and their Jenkins Pipeline equivalents.</p>
</div>
<div class="sect3">
<h4 id="boolean-condition"><a class="anchor" href="#boolean-condition"></a>Boolean condition</h4>
<div class="paragraph">
<p>You might think that a boolean condition would be the simplest condition, but it isn&#8217;t.
Since it works with string values from tokens, the Conditional BuildStep plugin offers
a number of ways to indicate true or false.
Truth is a case insensitive match of one of the following:
<code>1</code> (the number one), <code>Y</code>, <code>YES</code>, <code>T</code>, <code>TRUE</code>, <code>ON</code> or <code>RUN</code>.</p>
</div>
<div class="paragraph">
<p>Pipeline can duplicate these, but depending on the scenario we might consider
whether a simpler expression would suffice.</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-declarative">
    <div class="title">Jenkinsfile (Declarative Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">when {
    <span style="color:#777">// case insensitive regular expression for truthy values</span>
    expression { <span style="color:#080;font-weight:bold">return</span> token ==~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">(?i)(Y|YES|T|TRUE|ON|RUN)</span><span style="color:#404">/</span></span> }
}
steps {
    <span style="color:#777">/* step */</span>
}</code></pre>
</div></div>  <div class="pipeline-script-expand">
    <a href="#" onclick="javascript:$(this).parent().siblings('.pipeline-script').toggle(); return false;">Toggle Scripted Pipeline</a>
    <em>(Advanced)</em>
  </div>
  <div class="listingblock pipeline-script"
        style="display: none">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy"><span style="color:#777">// case insensitive regular expression for truthy values</span>
<span style="color:#080;font-weight:bold">if</span> (token ==~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">(?i)(Y|YES|T|TRUE|ON|RUN)</span><span style="color:#404">/</span></span>) {
    <span style="color:#777">/* step */</span>
}</code></pre>
</div></div></div>
</div>
<div class="sect3">
<h4 id="logical-or-of-conditions"><a class="anchor" href="#logical-or-of-conditions"></a>Logical "OR" of conditions</h4>
<div class="paragraph">
<p>This condition wraps other conditions.
It takes their results as inputs and performs a logical "or" of the results.
The <code>AND</code> and <code>NOT</code> conditions do the same, performing their respective operations.</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-declarative">
    <div class="title">Jenkinsfile (Declarative Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">when {
    <span style="color:#777">// A or B</span>
    expression { <span style="color:#080;font-weight:bold">return</span> A || B }
}
steps {
    <span style="color:#777">/* step */</span>
}</code></pre>
</div></div>  <div class="pipeline-script-expand">
    <a href="#" onclick="javascript:$(this).parent().siblings('.pipeline-script').toggle(); return false;">Toggle Scripted Pipeline</a>
    <em>(Advanced)</em>
  </div>
  <div class="listingblock pipeline-script"
        style="display: none">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy"><span style="color:#777">// A or B</span>
<span style="color:#080;font-weight:bold">if</span> (A || B) {
    <span style="color:#777">/* step */</span>
}</code></pre>
</div></div></div>
</div>
</div>
<div class="sect2">
<h3 id="tokens"><a class="anchor" href="#tokens"></a>Tokens</h3>
<div class="paragraph">
<p>Tokens can be considerably more work than conditions.
There are more of them and they cover a much broader range of behaviors.
The previous example showed one of the simpler cases, accessing a build parameter,
where the token has a direct equivalent in Pipeline.
However, many tokens don&#8217;t have direct equivalents,
some take a parameters (adding to their complexity),
and some provide information that is simply not exposed in Pipeline yet.
So, determining how to migrate tokens needs to be done on case-by-case basis.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a few examples.</p>
</div>
<div class="sect3">
<h4 id="file-token"><a class="anchor" href="#file-token"></a>"FILE" token</h4>
<div class="paragraph">
<p><strong>Expands to the contents of a file. The file path is relative to the build workspace root.</strong></p>
</div>
<div class="paragraph">
<p><em>${FILE,path="PATH"}</em></p>
</div>
<div class="paragraph">
<p>This token maps directly to the <code>readFile</code> step.
The only difference is the file path for <code>readFile</code> is relative to the
current working directory on the agent, but that is the workspace root by default.
No problem.</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-declarative">
    <div class="title">Jenkinsfile (Declarative Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">when {
    expression { <span style="color:#080;font-weight:bold">return</span> readFile(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">pom.xml</span><span style="color:#710">'</span></span>).contains(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mycomponent</span><span style="color:#710">'</span></span>) }
}
steps {
    <span style="color:#777">/* step */</span>
}</code></pre>
</div></div>  <div class="pipeline-script-expand">
    <a href="#" onclick="javascript:$(this).parent().siblings('.pipeline-script').toggle(); return false;">Toggle Scripted Pipeline</a>
    <em>(Advanced)</em>
  </div>
  <div class="listingblock pipeline-script"
        style="display: none">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy"><span style="color:#080;font-weight:bold">if</span> (readFile(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">pom.xml</span><span style="color:#710">'</span></span>).contains(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mycomponent</span><span style="color:#710">'</span></span>)) {
    <span style="color:#777">/* step */</span>
}</code></pre>
</div></div></div>
</div>
<div class="sect3">
<h4 id="git_branch"><a class="anchor" href="#git_branch"></a>GIT_BRANCH</h4>
<div class="paragraph">
<p><strong>Expands to the name of the branch that was built.</strong></p>
</div>
<div class="paragraph">
<p><strong>Parameters</strong> (descriptions omitted): <em>all</em>, <em>fullName</em>.</p>
</div>
<div class="paragraph">
<p>This information may or may not be exposed in Pipeline.  If you&#8217;re using the
<a href="https://plugins.jenkins.io/workflow-multibranch">Pipeline Multibranch plugin</a>
<code>env.BRANCH_NAME</code> will give similar basic information, but doesn&#8217;t offer the parameters.
There are also
<a href="https://issues.jenkins-ci.org/browse/JENKINS-35230">several</a>
<a href="https://issues.jenkins-ci.org/browse/JENKINS-24141">issues</a>
filed around <code>GIT_*</code> tokens in Pipeline.
Until they are addressed fully, we can follow the pattern shown in
<a href="https://github.com/jenkinsci/pipeline-examples/blob/master/pipeline-examples/gitcommit/gitcommit.groovy">pipeline-examples</a>,
executing a shell to get the information we need.</p>
</div>
<div class="listingblock">
<div class="title">Pipeline</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">GIT_BRANCH = sh(<span style="color:#606">returnStdout</span>: <span style="color:#069">true</span>, <span style="color:#606">script</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">git rev-parse --abbrev-ref HEAD</span><span style="color:#710">'</span></span>).trim()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="changes_since_last_success"><a class="anchor" href="#changes_since_last_success"></a>CHANGES_SINCE_LAST_SUCCESS</h4>
<div class="paragraph">
<p><strong>Displays the changes since the last successful build.</strong></p>
</div>
<div class="paragraph">
<p><strong>Parameters</strong> (descriptions omitted):
<em>reverse</em>, <em>format</em>, <em>changesFormat</em>, <em>showPaths</em>, <em>pathFormat</em>,
<em>showDependencies</em>, <em>dateFormat</em>, <em>regex</em>, <em>replace</em>, <em>default</em>.</p>
</div>
<div class="paragraph">
<p>Not only is the information provided by this token not exposed in Pipeline,
the token has ten optional parameters, including format strings and regular expression
searches. There are a number of ways we might get similar information in Pipeline.
Each have their own particular limitations and ways they differ from the token output.
Then we&#8217;ll need to consider how each of the parameters changes the output.
If nothing else, translating this token is clearly beyond the scope of this post.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="slightly-more-complex-example"><a class="anchor" href="#slightly-more-complex-example"></a>Slightly More Complex Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s do one more example that shows some of these conditions and tokens.
This time we&#8217;ll perform different build steps depending on what branch we&#8217;re building.
We&#8217;ll take two build parameters: <code>BRANCH_PATTERN</code> and <code>FORCE_FULL_BUILD</code>.
Based on <code>BRANCH_PATTERN</code>, we&#8217;ll checkout a repository.
If we&#8217;re building on the <code>master</code> branch or the user checked <code>FORCE_FULL_BUILD</code>,
we&#8217;ll call three other builds in parallel
(<code>full-build-linux</code>, <code>full-build-mac</code>, and <code>full-build-windows</code>),
wait for them to finish, and report the result.
If we&#8217;re not building on the <code>master</code> branch and the user did not check <code>FORCE_FULL_BUILD</code>,
we&#8217;ll print a message saying we skipped the full builds.</p>
</div>
<div class="sect2">
<h3 id="freestyle"><a class="anchor" href="#freestyle"></a>Freestyle</h3>
<div class="paragraph">
<p>Here&#8217;s the configuration for Freestyle version.
(It&#8217;s pretty long.  Feel free to <a href="#longer-pipeline">skip down to the Pipeline version</a>):</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Pipeline version of this job determines the <code>GIT_BRANCH</code> branch by
running a shell script that returns the current local branch name.
This means that the Pipeline version must checkout to a local branch (not a detached head).</p>
</div>
<div class="paragraph">
<p>Freestyle version of this job does not require a local branch, <code>GIT_BRANCH</code> is set automatically.
However, to maintain functional parity, the Freestyle version of this job includes
"Checkout to Specific Local Branch" as well.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock center">
<div class="content">
<img src="/images/post-images/2017-01-19/freestyle-conditional-long-full.png" alt="Longer Freestyle Job" width="800">
</div>
</div>
</div>
<div class="sect2">
<h3 id="longer-pipeline"><a class="anchor" href="#longer-pipeline"></a>Pipeline</h3>
<div class="paragraph">
<p>Here&#8217;s the equivalent Pipeline:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Freestyle version of this job is not stored in source control.</p>
</div>
<div class="paragraph">
<p>In general, the Pipeline version of this job would be stored in source control,
would <code>checkout scm</code>, and would run that same repository.
However, to maintain functional parity, the Pipeline version shown does a checkout
from source control but is not stored in that repository.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-declarative">
    <div class="title">Jenkinsfile (Declarative Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">pipeline {
    agent any
    parameters {
        string (
            <span style="color:#606">defaultValue</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">*</span><span style="color:#710">'</span></span>,
            <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>,
            name : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">BRANCH_PATTERN</span><span style="color:#710">'</span></span>)
        booleanParam (
            <span style="color:#606">defaultValue</span>: <span style="color:#069">false</span>,
            <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>,
            name : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">FORCE_FULL_BUILD</span><span style="color:#710">'</span></span>)
    }

    stages {
        stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Prepare</span><span style="color:#710">'</span></span>) {
            steps {
                checkout([<span style="color:#F00;background-color:#FAA">$</span><span style="color:#339;font-weight:bold">class</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">GitSCM</span><span style="color:#710">'</span></span>,
                    <span style="color:#B06;font-weight:bold">branches</span>: [[<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">origin/</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>BRANCH_PATTERN<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>]],
                    <span style="color:#606">doGenerateSubmoduleConfigurations</span>: <span style="color:#069">false</span>,
                    <span style="color:#606">extensions</span>: [[<span style="color:#F00;background-color:#FAA">$</span><span style="color:#339;font-weight:bold">class</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">LocalBranch</span><span style="color:#710">'</span></span>]],
                    <span style="color:#B06;font-weight:bold">submoduleCfg</span>: <span style="color:#339;font-weight:bold">[]</span>,
                    <span style="color:#606">userRemoteConfigs</span>: [[
                        <span style="color:#606">credentialsId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bitwiseman_github</span><span style="color:#710">'</span></span>,
                        <span style="color:#606">url</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">https://github.com/bitwiseman/hermann</span><span style="color:#710">'</span></span>]]])
            }
        }

        stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) {
            when {
                expression {
                    GIT_BRANCH = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">origin/</span><span style="color:#710">'</span></span> + sh(<span style="color:#606">returnStdout</span>: <span style="color:#069">true</span>, <span style="color:#606">script</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">git rev-parse --abbrev-ref HEAD</span><span style="color:#710">'</span></span>).trim()
                    <span style="color:#080;font-weight:bold">return</span> GIT_BRANCH == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">origin/master</span><span style="color:#710">'</span></span> || params.FORCE_FULL_BUILD
                }
            }
            steps {
                <span style="color:#777">// Freestyle build trigger calls a list of jobs</span>
                <span style="color:#777">// Pipeline build() step only calls one job</span>
                <span style="color:#777">// To run all three jobs in parallel, we use &quot;parallel&quot; step</span>
                <span style="color:#777">// https://jenkins.io/doc/pipeline/examples/#jobs-in-parallel</span>
                parallel (
                    <span style="color:#606">linux</span>: {
                        build <span style="color:#606">job</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">full-build-linux</span><span style="color:#710">'</span></span>, <span style="color:#606">parameters</span>: [string(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">GIT_BRANCH_NAME</span><span style="color:#710">'</span></span>, <span style="color:#606">value</span>: GIT_BRANCH)]
                    },
                    <span style="color:#606">mac</span>: {
                        build <span style="color:#606">job</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">full-build-mac</span><span style="color:#710">'</span></span>, <span style="color:#606">parameters</span>: [string(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">GIT_BRANCH_NAME</span><span style="color:#710">'</span></span>, <span style="color:#606">value</span>: GIT_BRANCH)]
                    },
                    <span style="color:#606">windows</span>: {
                        build <span style="color:#606">job</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">full-build-windows</span><span style="color:#710">'</span></span>, <span style="color:#606">parameters</span>: [string(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">GIT_BRANCH_NAME</span><span style="color:#710">'</span></span>, <span style="color:#606">value</span>: GIT_BRANCH)]
                    },
                    <span style="color:#606">failFast</span>: <span style="color:#069">false</span>)
            }
        }
        stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build Skipped</span><span style="color:#710">'</span></span>) {
            when {
                expression {
                    GIT_BRANCH = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">origin/</span><span style="color:#710">'</span></span> + sh(<span style="color:#606">returnStdout</span>: <span style="color:#069">true</span>, <span style="color:#606">script</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">git rev-parse --abbrev-ref HEAD</span><span style="color:#710">'</span></span>).trim()
                    <span style="color:#080;font-weight:bold">return</span> !(GIT_BRANCH == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">origin/master</span><span style="color:#710">'</span></span> || params.FORCE_FULL_BUILD)
                }
            }
            steps {
                echo <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Skipped full build.</span><span style="color:#710">'</span></span>
            }
        }
    }
}</code></pre>
</div></div>  <div class="pipeline-script-expand">
    <a href="#" onclick="javascript:$(this).parent().siblings('.pipeline-script').toggle(); return false;">Toggle Scripted Pipeline</a>
    <em>(Advanced)</em>
  </div>
  <div class="listingblock pipeline-script"
        style="display: none">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">properties ([
    parameters ([
        string (
            <span style="color:#606">defaultValue</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">*</span><span style="color:#710">'</span></span>,
            <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>,
            name : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">BRANCH_PATTERN</span><span style="color:#710">'</span></span>),
        booleanParam (
            <span style="color:#606">defaultValue</span>: <span style="color:#069">false</span>,
            <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>,
            name : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">FORCE_FULL_BUILD</span><span style="color:#710">'</span></span>)
    ])
])

node {
    stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Prepare</span><span style="color:#710">'</span></span>) {
        checkout([<span style="color:#F00;background-color:#FAA">$</span><span style="color:#339;font-weight:bold">class</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">GitSCM</span><span style="color:#710">'</span></span>,
            <span style="color:#B06;font-weight:bold">branches</span>: [[<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">origin/</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>BRANCH_PATTERN<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>]],
            <span style="color:#606">doGenerateSubmoduleConfigurations</span>: <span style="color:#069">false</span>,
            <span style="color:#606">extensions</span>: [[<span style="color:#F00;background-color:#FAA">$</span><span style="color:#339;font-weight:bold">class</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">LocalBranch</span><span style="color:#710">'</span></span>]],
            <span style="color:#B06;font-weight:bold">submoduleCfg</span>: <span style="color:#339;font-weight:bold">[]</span>,
            <span style="color:#606">userRemoteConfigs</span>: [[
                <span style="color:#606">credentialsId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bitwiseman_github</span><span style="color:#710">'</span></span>,
                <span style="color:#606">url</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">https://github.com/bitwiseman/hermann</span><span style="color:#710">'</span></span>]]])
    }

    stage (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) {
        GIT_BRANCH = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">origin/</span><span style="color:#710">'</span></span> + sh(<span style="color:#606">returnStdout</span>: <span style="color:#069">true</span>, <span style="color:#606">script</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">git rev-parse --abbrev-ref HEAD</span><span style="color:#710">'</span></span>).trim()
        <span style="color:#080;font-weight:bold">if</span> (GIT_BRANCH == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">origin/master</span><span style="color:#710">'</span></span> || params.FORCE_FULL_BUILD) {

            <span style="color:#777">// Freestyle build trigger calls a list of jobs</span>
            <span style="color:#777">// Pipeline build() step only calls one job</span>
            <span style="color:#777">// To run all three jobs in parallel, we use &quot;parallel&quot; step</span>
            <span style="color:#777">// https://jenkins.io/doc/pipeline/examples/#jobs-in-parallel</span>
            parallel (
                <span style="color:#606">linux</span>: {
                    build <span style="color:#606">job</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">full-build-linux</span><span style="color:#710">'</span></span>, <span style="color:#606">parameters</span>: [string(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">GIT_BRANCH_NAME</span><span style="color:#710">'</span></span>, <span style="color:#606">value</span>: GIT_BRANCH)]
                },
                <span style="color:#606">mac</span>: {
                    build <span style="color:#606">job</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">full-build-mac</span><span style="color:#710">'</span></span>, <span style="color:#606">parameters</span>: [string(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">GIT_BRANCH_NAME</span><span style="color:#710">'</span></span>, <span style="color:#606">value</span>: GIT_BRANCH)]
                },
                <span style="color:#606">windows</span>: {
                    build <span style="color:#606">job</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">full-build-windows</span><span style="color:#710">'</span></span>, <span style="color:#606">parameters</span>: [string(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">GIT_BRANCH_NAME</span><span style="color:#710">'</span></span>, <span style="color:#606">value</span>: GIT_BRANCH)]
                },
                <span style="color:#606">failFast</span>: <span style="color:#069">false</span>)

        } <span style="color:#080;font-weight:bold">else</span> {
            echo <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Skipped full build.</span><span style="color:#710">'</span></span>
        }
    }
}</code></pre>
</div></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As I said before, the Conditional BuildStep plugin is great.
It provides a clear, easy to understand way to add conditional logic to any Freestyle job.
Before Pipeline, it was one of the few plugins to do this and it remains one of the most popular plugins.
Now that we have Pipeline, we can implement conditional logic directly in code.</p>
</div>
<div class="paragraph">
<p>This is blog post discussed how to approach converting conditional build steps to Pipeline
and showed a couple concrete examples.  Overall, I&#8217;m pleased with the results so far.
I found scenarios which could not easily be migrated to Pipeline, but even those
are only more difficult, rather than impossible.</p>
</div>
<div class="paragraph">
<p>The next thing to do is add a section to the
<a href="/doc/book/">Jenkins Handbook</a> documenting the Pipeline
equivalent of all of the Conditions and the most commonly used Tokens.
Look for it soon!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="links"><a class="anchor" href="#links"></a>Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://plugins.jenkins.io/conditional-buildstep">Conditional BuildStep plugin</a></p>
</li>
</ul>
</div>
</div>
</div>
<b class="author about-header">
About the Author
</b>
<!-- starting partial author.html.haml -->
<div id="about-the-author">
<table class="author box">
<tr>
<td>
<!-- starting partial avatar.html.haml -->
<img alt="Liam Newman" class="author logo" src="https://zbynek.github.io/jenkins.io/order-syntax/images/avatars/lnewman.jpeg" width="128px">

<!-- ending partial avatar.html.haml -->
</td>
<td>
<b class="author name">
<a href="/blog/authors/lnewman">
Liam Newman
</a>
</b>
<p>
<div class="paragraph">
<p>Liam started his software career as a tester, which might explain why he&#8217;s such a fan of CI/CD and Pipeline as Code.
He has spent the majority of his software engineering career implementing Continuous Integration systems at companies big and small.
He is a Jenkins project contributor and an expert in Jenkins Pipeline, both Scripted and Declarative.
Liam currently works as a Jenkins Evangelist at <a href="https://cloudbees.com">CloudBees</a>.
When not at work, he enjoys testing gravity by doing Aikido.</p>
</div>
</p>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="author social-media-buttons">
<li class="author">
<a href="https://github.com/bitwiseman" target="_blank">
GitHub
</a>
</li>
<li class="author">
<a href="https://twitter.com/bitwiseman" target="_blank">
Twitter
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</td>
</tr>
</table>
</div>

<!-- ending partial author.html.haml -->
</div>
</div>
</div>


<script src="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/anchor-js/anchor.min.js"></script>
<script src="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/tether/js/tether.min.js"></script>
<script src="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<footer id="footer">
<div class="container">
<div class="row">
<div class="col-md-4">
<p class="box">
<a href="https://github.com/jenkins-infra/jenkins.io/edit/master/content//blog/2017/01/2017-01-19-converting-conditional-to-pipeline.adoc" title="Edit /blog/2017/01/2017-01-19-converting-conditional-to-pipeline.adoc on GitHub">Improve this page</a>
|
<a href="https://github.com/jenkins-infra/jenkins.io/commits/master/content//blog/2017/01/2017-01-19-converting-conditional-to-pipeline.adoc" title="View /blog/2017/01/2017-01-19-converting-conditional-to-pipeline.adoc history on GitHub">Page history</a>
</p>
<div class="license-box">
<div id="creativecommons">
<a href="https://creativecommons.org/licenses/by-sa/4.0/">
<p>
<img alt="Creative Commons Attribution-ShareAlike license" src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
</p>
</a>
<p>
The content driving this site is licensed under the Creative
Commons Attribution-ShareAlike 4.0 license.
</p>
</div>
</div>
</div>
<div class="links col-md-8">
<div class="container">
<div class="row">
<div class="area col-md-3">
<div class="div-mar">
<h5>Resources</h5>
<ul class="resources">
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/download">
Downloads
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/node">
Blog
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/doc">
Documentation
</a>
</li>
<li>
<a href="https://plugins.jenkins.io/">
Plugins
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/security">
Security
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/participate">
Contributing
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Project</h5>
<ul class="project">
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/project">
Structure and governance
</a>
</li>
<li>
<a href="https://issues.jenkins-ci.org">
Issue tracker
</a>
</li>
<li>
<a href="https://wiki.jenkins.io">
Wiki
</a>
</li>
<li>
<a href="https://github.com/jenkinsci">
GitHub
</a>
</li>
<li>
<a href="https://ci.jenkins.io">
Jenkins on Jenkins
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Community</h5>
<ul class="community">
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/events">
Events
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/mailing-lists">
Mailing lists
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/chat">
Chats
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/sigs">
Special Interest Groups
</a>
</li>
<li>
<a href="https://twitter.com/jenkinsci">
Twitter
</a>
</li>
<li>
<a href="https://reddit.com/r/jenkinsci">
Reddit
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Other</h5>
<ul class="other">
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/conduct">
Code of Conduct
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/press">
Press information
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/merchandise">
Merchandise
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/artwork">
Artwork
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/awards">
Awards
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
  
  $(function(){
    var $body = $(document.body);
    $(".nav-link.dropdown-toggle").on("mousedown", function(){
      $body.addClass("no-outline");
    })
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
</body>
</html>
