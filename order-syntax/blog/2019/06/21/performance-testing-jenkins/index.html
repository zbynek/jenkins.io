<!DOCTYPE html>
<html lang="en">
<head>
<title>
Micro-benchmarking Framework for Jenkins Plugins
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Micro-benchmarking Framework for Jenkins Plugins" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Micro-benchmarking Framework for Jenkins Plugins" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="https://zbynek.github.io/jenkins.io/order-syntax/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Micro-benchmarking Framework for Jenkins Plugins" property="og:title">
<meta content="article" property="og:type">
<meta content="https://zbynek.github.io/jenkins.io/order-syntax/blog/2019/06/21/performance-testing-jenkins/index.html" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Micro-benchmarking Framework for Jenkins Plugins" property="og:site_name">
<meta content="https://zbynek.github.io/jenkins.io/order-syntax/images/logo-title-opengraph.png" name="og:image">
<link href="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/tether/css/tether.min.css" media="screen" rel="stylesheet">
<link href="https://zbynek.github.io/jenkins.io/order-syntax/css/font-icons.css" media="screen" rel="stylesheet">
<link href="https://zbynek.github.io/jenkins.io/order-syntax/css/jenkins.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/ionicons/css/ionicons.min.css" media="screen" rel="stylesheet">
<link href="https://zbynek.github.io/jenkins.io/order-syntax/css/footer.css" media="screen" rel="stylesheet">
<link href="https://zbynek.github.io/jenkins.io/order-syntax/css/font-awesome.min.css" media="screen" rel="stylesheet">
</head>
<body>
<script src="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<nav class="navbar navbar-expand-lg navbar-dark top bg-dark fixed-top" id="ji-toolbar">
<a class="navbar-brand" href="https://zbynek.github.io/jenkins.io/order-syntax">
Jenkins
</a>
<button class="navbar-toggler" data-target="#CollapsingNavbar" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="CollapsingNavbar">
<ul class="nav navbar-nav mr-auto">
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
<!-- starting partial cdf_logo.html.haml -->
<svg width="36" height="18" xmlns="http://www.w3.org/2000/svg" role="img" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-3.23 44.77 362.70 271.95"><defs><linearGradient id="a" x1="359.765" x2="104.082" y1="134.295" y2="124.577" gradientTransform="matrix(1 0 0 -1 0 439.068)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ed1c24"/><stop offset="1" stop-color="#f7941d"/></linearGradient><linearGradient id="b" x1="355.202" x2="99.519" y1="254.467" y2="244.749" xlink:href="#a"/><linearGradient id="c" x1="183.903" x2="10.612" y1="227.598" y2="221.023" xlink:href="#a"/><linearGradient id="d" x1="367.119" x2="157.995" y1="265.311" y2="257.091" xlink:href="#a"/></defs><path fill="#c49a6c" d="M231.52 309.278c2.483-.332 4.895-.77 7.255-1.329s4.649-1.206 6.991-1.957c13.494-4.58 25.187-12.952 36.374-24.593l-.14-.175c-14.944 15.486-30.693 25.344-50.48 28.054z"/><path fill="url(#a)" d="M224.232 309.96h.332c1.084 0 2.15-.14 3.216-.228a93.844 93.844 0 0 1-3.233.227z"/><path fill="url(#b)" d="M284.692 187.187l-.122.192.122-.192z"/><path fill="url(#c)" d="M146.145 231.847a150.844 150.844 0 0 1-12.97 15.862c-7.582 7.889-15.507 13.563-24.652 16.667a47.832 47.832 0 0 1-4.738 1.326 56.959 56.959 0 0 1-4.916.9 38.32 38.32 0 0 1-1.682.214l-.912.083c-.723.059-1.445.118-2.18.154h-3.068a42.325 42.325 0 0 1-9.192-1.043 49.977 49.977 0 0 1-6.764-2.002 43.097 43.097 0 0 1-4.525-1.954c-1.493-.77-2.961-1.516-4.407-2.37a59.5 59.5 0 0 1-17.105-15.399 59.714 59.714 0 0 1-2.914-4.311 53.09 53.09 0 0 1-1.291-2.263 51.985 51.985 0 0 1-2.263-4.738 46.72 46.72 0 0 1 0-36.426 51.986 51.986 0 0 1 2.263-4.738 54.14 54.14 0 0 1 1.291-2.263 59.742 59.742 0 0 1 2.914-4.311 59.714 59.714 0 0 1 17.105-15.4 60.828 60.828 0 0 1 4.407-2.369q2.217-1 4.525-1.777a49.976 49.976 0 0 1 6.906-2.073 42.325 42.325 0 0 1 9.192-1.042h3.128c.722 0 1.445.094 2.155.154l1.043.106 1.019.119c1.8.237 3.553.557 5.271.96.853.2 1.694.426 2.523.663a51.186 51.186 0 0 1 11.846 5.176 59.645 59.645 0 0 1 4.395 2.89 74.485 74.485 0 0 1 8.386 7.108q2.038 1.99 4.063 4.193l.083-.13a159.395 159.395 0 0 1 11.064 13.942c5.437-8.576 13.658-21.464 16.584-25.74 1.185-1.718 2.37-3.46 3.66-5.212-13.54-16.513-29.827-30.23-51.587-36.082h-.154a89.397 89.397 0 0 0-3.187-.794l-.45-.107a92.565 92.565 0 0 0-3.151-.627l-.628-.119a80.578 80.578 0 0 0-3.743-.569h-.142a58.29 58.29 0 0 0-2.073-.236h-.391l-1.872-.166h-.568l-1.754-.119h-.675l-1.777-.07h-3.115c-46.447-.25-87.125 40.476-87.125 86.911s40.725 87.173 87.172 87.173h3.14l1.729-.071h.734l1.67-.095h.676l1.706-.154h.568l1.813-.213.414-.06 1.967-.272h.213a125.91 125.91 0 0 0 3.553-.628l.652-.142c.96-.201 1.907-.415 2.855-.64l.58-.142a86.66 86.66 0 0 0 3.009-.817l.237-.071c20.73-6.077 36.425-19.392 49.55-35.277-2.037-3.068-3.4-5.366-4.039-6.48z"/><path fill="url(#d)" d="M318.05 51.733v94.66a85.514 85.514 0 0 0-52.595-18.729h-3.115l-1.777.072-.7.047-1.752.118h-.569l-1.871.166h-.391c-.7.071-1.386.142-2.073.237h-.154c-1.256.154-2.5.355-3.732.569l-.628.118c-1.066.19-2.108.403-3.15.628l-.45.107c-30.35 6.858-50.333 28.808-66.822 52.82-.7 1.018-1.35 2.049-2.038 3.068-2.25 3.423-5.46 8.422-8.635 13.397-4.17 6.527-8.292 13.03-9.939 15.66l20.624 32.137s21.997 40.465 61.68 51.482l.237.07c.995.297 2.002.558 3.009.818l.58.142c.936.237 1.896.439 2.855.64l.652.142c1.184.225 2.369.439 3.553.628h.214l1.966.273.415.059 1.812.213h.569l1.705.154h.676l1.67.095h.734l1.73.07h3.139c54.703 0 86.355-30.964 87.149-85.063V51.733zm-52.595 215.403h-3.068c-.734 0-1.457-.095-2.18-.154l-.912-.083c-.568-.06-1.125-.13-1.682-.213a49.077 49.077 0 0 1-9.571-2.275 49.612 49.612 0 0 1-6.634-2.83 55.792 55.792 0 0 1-6.254-3.768 63.068 63.068 0 0 1-3.009-2.215 82.399 82.399 0 0 1-8.683-7.925l-.095.119c-1.255-1.303-2.487-2.69-3.731-4.11-.154-.167-.296-.356-.45-.534-.628-.722-1.256-1.445-1.884-2.215s-1.125-1.398-1.682-2.097-.888-1.101-1.338-1.682a184.467 184.467 0 0 1-6.053-8.292c-.7-.995-1.398-2.025-2.109-3.056-.379-.569-.77-1.184-1.185-1.73-.675-1.018-1.362-2.013-2.049-3.056l-.355-.545c-1.185-1.812-2.37-3.684-3.649-5.603q2.95-4.608 5.817-8.86c1.907-2.831 3.79-5.556 5.662-8.138s3.72-5.046 5.591-7.38 3.72-4.525 5.603-6.586q2.026-2.203 4.063-4.194c1.374-1.338 2.748-2.594 4.158-3.778s2.807-2.287 4.252-3.329a57.594 57.594 0 0 1 7.748-4.62c.331-.166.663-.367 1.006-.533l.226-.118c1.41-.652 2.843-1.185 4.3-1.73l.485-.201c.273-.083.557-.142.83-.237a44.943 44.943 0 0 1 3.34-.948l1.374-.343a60.798 60.798 0 0 1 4.738-.841l1.019-.119 1.042-.106c.711 0 1.434-.119 2.156-.154h3.128a42.431 42.431 0 0 1 4.572.26 48.011 48.011 0 0 1 6.93 1.35c1.54.427 3.08.925 4.596 1.505a48.724 48.724 0 0 1 4.525 1.955c1.493.722 2.961 1.516 4.407 2.369s2.866 1.8 4.24 2.784 2.725 2.049 4.028 3.174a58.459 58.459 0 0 1 8.837 9.477 59.73 59.73 0 0 1 2.914 4.312 51.067 51.067 0 0 1 5.318 11.916 47.38 47.38 0 0 1 1.185 5.165 45.567 45.567 0 0 1 .71 8.09c.072 35.964-16.062 52.122-52.227 52.122z"/></svg>

<!-- ending partial cdf_logo.html.haml -->
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://cd.foundation/">
What is CDF?
</a>
<a class="dropdown-item feature" href="https://jenkins-x.io/">
Jenkins X
</a>
<a class="dropdown-item feature" href="https://cloud.google.com/tekton/">
Tekton
</a>
<a class="dropdown-item feature" href="https://www.spinnaker.io/">
Spinnaker
</a>
</div>
</li>
</ul>
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node">
Blog
</a>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Documentation
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/doc">
Use Jenkins
</a>
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/doc/developer">
Extend Jenkins
</a>
<span class="dropdown-item">
<strong>
Use-cases
</strong>
</span>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/android">
&nbsp;-&nbsp;Android
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/c">
&nbsp;-&nbsp;C/C++
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/docker">
&nbsp;-&nbsp;Docker
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/embedded">
&nbsp;-&nbsp;Embedded
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/github">
&nbsp;-&nbsp;GitHub
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/java">
&nbsp;-&nbsp;Java
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/php">
&nbsp;-&nbsp;PHP
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/pipeline">
&nbsp;-&nbsp;Continuous Delivery
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/python">
&nbsp;-&nbsp;Python
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/solutions/ruby">
&nbsp;-&nbsp;Ruby
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://plugins.jenkins.io/">
Plugins
</a>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Community
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/participate">
Overview
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/chat" title="Chat with the rest of the Jenkins community on IRC">
Chat
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/jam">
Meet
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/events">
Events
</a>
<a class="dropdown-item feature" href="https://issues.jenkins-ci.org/">
Issue Tracker
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/mailing-lists" title="Browse Jenkins mailing list archives and/or subscribe to lists">
Mailing Lists
</a>
<a class="dropdown-item feature" href="https://wiki.jenkins.io/">
Wiki
</a>
<a class="dropdown-item feature" href="https://accounts.jenkins.io/" title="Create/manage your account for accessing wiki, issue tracker, etc">
Account Management
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/">
<strong>
Special Interest Groups
</strong>
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/advocacy-and-outreach/">
&nbsp;-&nbsp;Advocacy and Outreach
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/chinese-localization/">
&nbsp;-&nbsp;Chinese Localization
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/cloud-native/">
&nbsp;-&nbsp;Cloud Native
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/docs/">
&nbsp;-&nbsp;Documentation
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/gsoc/">
&nbsp;-&nbsp;Google Summer of Code
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/hw-and-eda/">
&nbsp;-&nbsp;Hardware and EDA
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/pipeline-authoring/">
&nbsp;-&nbsp;Pipeline Authoring
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/sigs/platform/">
&nbsp;-&nbsp;Platform
</a>
</div>
</li>
<li class="dropdown nav-item">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
Subprojects
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/">
Overview
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/blueocean/">
Blue Ocean
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/evergreen/">
Evergreen
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/gsoc/">
Google Summer of Code in Jenkins
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/infrastructure/">
Infrastructure
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/jam/">
Jenkins Area Meetups
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/jcasc/">
Jenkins Configuration as Code
</a>
<a class="dropdown-item feature" href="https://zbynek.github.io/jenkins.io/order-syntax/projects/remoting/">
Jenkins Remoting
</a>
</div>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
About
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/security">
Security
</a>
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/press">
Press
</a>
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/awards">
Awards
</a>
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/project/conduct">
Conduct
</a>
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/artwork">
Artwork
</a>
</div>
</li>
<li class="nav-item dropdown">
<!-- starting partial dropdown.html.haml -->
<button aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown">
English
</button>

<!-- ending partial dropdown.html.haml -->
<div class="dropdown-menu">
<a class="dropdown-item" href="https://zbynek.github.io/jenkins.io/order-syntax/zh">
中文 Chinese
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link btn btn-outline-secondary" href="https://zbynek.github.io/jenkins.io/order-syntax/download">
Download
</a>
</li>
</ul>
</div>
</nav>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<script>
  $(function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('#content h' + i);
    }
  })
</script>
<div class="container blog-post">
<div class="row body">
<div class="col-md-11 col-md-offset-1 main-content" id="content">
<div id="content-top">
<h1>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/blog/2019/06/21/performance-testing-jenkins/" title="Micro-benchmarking Framework for Jenkins Plugins">
Micro-benchmarking Framework for Jenkins Plugins
</a>
</h1>
<div style="float: right; clear: all;">
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/share">
Tweet
</a>
</div>
<div class="post-attrs">
<span class="submitted">
Published on
2019-06-21
by
<a href="/blog/authors/abhyudayasharma">Abhyudaya Sharma</a>
</span>
<ul class="list-inline tags">
<li>
<a class="tag-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node/tags/jmh">
jmh
</a>
</li>
<li>
<a class="tag-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node/tags/plugins">
plugins
</a>
</li>
<li>
<a class="tag-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node/tags/benchmark">
benchmark
</a>
</li>
<li>
<a class="tag-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node/tags/performance">
performance
</a>
</li>
<li>
<a class="tag-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node/tags/developer">
developer
</a>
</li>
<li>
<a class="tag-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node/tags/gsoc">
gsoc
</a>
</li>
<li>
<a class="tag-link" href="https://zbynek.github.io/jenkins.io/order-syntax/node/tags/gsoc2019">
gsoc2019
</a>
</li>
</ul>
</div>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>I have been working on improving the performance of the Role Strategy Plugin as a part of my <a href="/projects/gsoc/2019/role-strategy-performance/">Google Summer of Code project</a>.
Since there was no existing way to measure performance and do benchmarks on Jenkins Plugins,
my work for the first phase of the project was to create a framework for running
benchmarks in Jenkins plugins with a Jenkins instance available. To make our job a bit easier,
we chose <a href="http://openjdk.java.net/jeps/230">Java Microbenchmark Harness</a> for running these benchmarks. This
allows us to reliably measure performance of our time-critical functions and will help make Jenkins perform faster
for everyone.</p>
</div>
<div class="paragraph">
<p>The micro-benchmarking framework was recently released in the Jenkins Unit Test Harness <a href="https://github.com/jenkinsci/jenkins-test-harness/releases/tag/jenkins-test-harness-2.50">2.50</a>.
The blog post below shows how to run benchmarks in your plugins.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The framework runs works by starting a temporary Jenkins instance for each fork of the JMH benchmark,
just like <code>JenkinsRule</code> from Jenkins Test Harness. Benchmarks are run directly from your JUnit Tests which allows
you to fail builds on the fly and easily run benchmarks from your IDE, just like unit tests. You can easily
configure your benchmarks by either using your Java methods, or by using Jenkins <a href="https://plugins.jenkins.io/configuration-as-code">Configuration-as-Code plugin</a>
and passing the path to your YAML file.</p>
</div>
<div class="paragraph">
<p>To run benchmarks from your plugins, you need to do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>bump up the minimum required Jenkins version to 2.60.3 or above</p>
</li>
<li>
<p>bump Plugin-POM to a version ≥ 3.46 or manually upgrade to Jenkins Test Harness ≥ 2.51.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now, to run the benchmarks, you need to have a benchmark runner that contains a <code>@Test</code> so it can run
like a JUnit test. From inside a test method, you can use the <code>OptionsBuilder</code> provided by JMH to
configure your benchmarks. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">BenchmarkRunner</span> {
    <span style="color:#007">@Test</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> runJmhBenchmarks() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
        ChainedOptionsBuilder options = <span style="color:#080;font-weight:bold">new</span> OptionsBuilder()
                .mode(Mode.AverageTime)
                .forks(<span style="color:#00D">2</span>)
                .result(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jmh-report.json</span><span style="color:#710">&quot;</span></span>);

        <span style="color:#777">// Automatically detect benchmark classes annotated with @JmhBenchmark</span>
        <span style="color:#080;font-weight:bold">new</span> BenchmarkFinder(getClass()).findBenchmarks(options);
        <span style="color:#080;font-weight:bold">new</span> Runner(options.build()).run();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sample-benchmarks"><a class="anchor" href="#sample-benchmarks"></a>Sample benchmarks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now, you can write your first benchmark:</p>
</div>
<div class="paragraph">
<p><strong>Without any special setup</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span style="color:#007">@JmhBenchmark</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">JmhStateBenchmark</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyState</span> <span style="color:#088;font-weight:bold">extends</span> JmhBenchmarkState {
    }

    <span style="color:#007">@Benchmark</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> benchmark(MyState state) {
        <span style="color:#777">// benchmark code goes here</span>
        state.getJenkins().setSystemMessage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello world</span><span style="color:#710">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Using Configuration as Code</strong></p>
</div>
<div class="paragraph">
<p>To use configuration as code, apart from the dependencies above you also need to add the following
to your <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>io.jenkins<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>configuration-as-code<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.21<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;optional&gt;</span>true<span style="color:#070;font-weight:bold">&lt;/optional&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
<span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>io.jenkins<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>configuration-as-code<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.21<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;classifier&gt;</span>tests<span style="color:#070;font-weight:bold">&lt;/classifier&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;scope&gt;</span>test<span style="color:#070;font-weight:bold">&lt;/scope&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now configuring a benchmark is as simple as providing path to your YAML file and specifying the class
containing the benchmark state.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><span style="color:#007">@JmhBenchmark</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SampleBenchmark</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyState</span> <span style="color:#088;font-weight:bold">extends</span> CascJmhBenchmarkState {
        <span style="color:#007">@Nonnull</span>
        <span style="color:#007">@Override</span>
        <span style="color:#088;font-weight:bold">protected</span> <span style="color:#0a8;font-weight:bold">String</span> getResourcePath() {
            <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">config.yml</span><span style="color:#710">&quot;</span></span>;
        }

        <span style="color:#007">@Nonnull</span>
        <span style="color:#007">@Override</span>
        <span style="color:#088;font-weight:bold">protected</span> <span style="color:#0a8;font-weight:bold">Class</span>&lt;?&gt; getEnclosingClass() {
            <span style="color:#080;font-weight:bold">return</span> SampleBenchmark.class;
        }
    }

    <span style="color:#007">@Benchmark</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> benchmark(MyState state) {
        Jenkins jenkins = state.getJenkins(); <span style="color:#777">// jenkins is configured and ready to be benchmarked.</span>
        <span style="color:#777">// your benchmark code goes here...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>More Samples</strong></p>
</div>
<div class="paragraph">
<p>As a part of this project, a few benchmarks have been created in the Role Strategy Plugin which show
configuring the instances for various situations. You can find them
<a href="https://github.com/jenkinsci/role-strategy-plugin/tree/master/src/test/java/jmh/benchmarks">here</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-benchmarks"><a class="anchor" href="#running-benchmarks"></a>Running Benchmarks</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Running benchmarks from Maven</strong></p>
</div>
<div class="paragraph">
<p>To easily run benchmarks from Maven, a Maven profile to run the benchmarks has been created
and is available starting Plugin-POM version 3.45. You can then run your benchmarks from the
command line using <code>mvn test -Dbenchmark</code>.</p>
</div>
<div class="paragraph">
<p><strong>Running benchmarks on ci.jenkins.io</strong></p>
</div>
<div class="paragraph">
<p>If you have your plugins hosted on ci.jenkins.io, you can easily run benchmarks directly from your Jenkinsfile
by using the <code>runBenchmarks()</code> method after the <code>buildPlugin()</code> step in your which is now available in
<a href="https://github.com/jenkins-infra/pipeline-library">Jenkins Pipeline library</a>.
This function also accepts the path to your generated JMH benchmark reports as an optional
parameter and archives the benchmark results. Running benchmarks in pull request builds allows you to constantly
monitor the performance implications of a given change. For example, the Jenkinsfile from Role Strategy Plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">buildPlugin()
runBenchmarks(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">jmh-report.json</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="visualizing-benchmark-results"><a class="anchor" href="#visualizing-benchmark-results"></a>Visualizing benchmark results</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Benchmark reports generated (in JSON) can be visualized using the either the <a href="https://plugins.jenkins.io/jmh-report">JMH Report Plugin</a>
or by passing the benchmark reports to the <a href="https://jmh.morethan.io">JMH visualizer</a> web service. As an example, here is
a visualized report of some benchmarks from the Role Strategy Plugin:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/post-images/jmh-microbenchmark-framework/jmh-visualizer.png" alt="Role Strategy Plugin benchmarks visualized by JMH Visualizer">
</div>
</div>
<div class="paragraph">
<p>These improvements seen above were obtained through a small <a href="https://github.com/jenkinsci/role-strategy-plugin/pull/81">pull request</a>
to the plugin and shows how even seemingly small changes can bring major performance improvements. Microbenchmarks
help to find these hot-spots and estimate the impact of changes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="some-tips-and-tricks"><a class="anchor" href="#some-tips-and-tricks"></a>Some tips and tricks</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Since <code>BenchmarkRunner</code> class name in the example above does not qualify as a test according to Maven surefire plugin&#8217;s
naming conventions, the benchmarks will not interfere with your JUnit tests.</p>
</li>
<li>
<p>Benchmark methods need to be annotated by <code>@Benchmark</code> for JMH to detect them.</p>
</li>
<li>
<p>Classes containing benchmarks are found automatically by the <code>BenchmarkFinder</code>
when annotated with <code>@JmhBenchmark</code>.</p>
</li>
<li>
<p>A reference to the Jenkins instance is available through either <code>JmhBenchmarkState#getJenkins()</code> or through
<code>Jenkins.getInstance()</code> like you would otherwise do.</p>
</li>
<li>
<p><code>JmhBenchmarkState</code> provides <code>setup()</code> and <code>tearDown()</code> methods which can be overridden to configure the
Jenkins instance according to your benchmark&#8217;s requirements.</p>
</li>
<li>
<p>The benchmark builds on ci.jenkins.io are currently throttled because of the limited availability of <code>highmem</code> nodes.</p>
</li>
<li>
<p>The benchmark framework was made available in Jenkins Test Harness 2.50, it is recommended to use version <a href="https://github.com/jenkinsci/jenkins-test-harness/releases/tag/jenkins-test-harness-2.51">2.51</a> as it includes some bug fixes.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="links-and-feedback"><a class="anchor" href="#links-and-feedback"></a>Links and Feedback</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have any feedback, comments or questions, please feel free to reach out to me through either
the <a href="https://gitter.im/jenkinsci/role-strategy-plugin">Role Strategy Plugin Gitter chat</a> or through
the <a href="mailto:jenkinsci-dev@googlegroups.com">Jenkins Developer Mailing list</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://drive.google.com/file/d/1gig6u64rzvSzGKjN_PTTXTkSXQ9Ah7E5/view?usp=sharing">Presentation slides</a></p>
</li>
<li>
<p><a href="https://youtu.be/lyfbmhQd0Ag?t=847">Demo at Platform SIG meeting</a></p>
</li>
<li>
<p>Documentation for the micro-benchmark framework:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jenkinsci/jenkins-test-harness/blob/master/docs/jmh-benchmarks.adoc">Writing benchmarks (Jenkins Test Harness)</a></p>
</li>
<li>
<p><a href="https://github.com/jenkinsci/configuration-as-code-plugin/blob/master/docs/benchmarks/jmh-benchmarks.md">Preconfiguring benchmarks using JCasC</a></p>
</li>
<li>
<p><a href="https://github.com/jenkinsci/plugin-pom#running-benchmarks">Running benchmarks using Plugin POM profile</a></p>
</li>
<li>
<p><a href="https://github.com/jenkins-infra/pipeline-library#runbenchmarks">Build Step for running benchmarks on ci.jenkins.io</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<b class="author about-header">
About the Author
</b>
<!-- starting partial author.html.haml -->
<div id="about-the-author">
<table class="author box">
<tr>
<td>
<!-- starting partial avatar.html.haml -->
<img alt="Abhyudaya Sharma" class="author logo" src="https://zbynek.github.io/jenkins.io/order-syntax/images/avatars/abhyudayasharma.jpg" width="128px">

<!-- ending partial avatar.html.haml -->
</td>
<td>
<b class="author name">
<a href="/blog/authors/abhyudayasharma">
Abhyudaya Sharma
</a>
</b>
<p>
<div class="paragraph">
<p>Abhyudaya is a Computer Science student at Shiv Nadar University, India.
He is participating in Google Summer of Code 2019 to improve the performance
of the <a href="https://github.com/jenkinsci/role-strategy-plugin">Role Strategy Plugin</a>.</p>
</div>
</p>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="author social-media-buttons">
<li class="author">
<a href="https://github.com/AbhyudayaSharma" target="_blank">
GitHub
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</td>
</tr>
</table>
</div>

<!-- ending partial author.html.haml -->
</div>
</div>
</div>


<script src="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/anchor-js/anchor.min.js"></script>
<script src="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/tether/js/tether.min.js"></script>
<script src="https://zbynek.github.io/jenkins.io/order-syntax/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<footer id="footer">
<div class="container">
<div class="row">
<div class="col-md-4">
<p class="box">
<a href="https://github.com/jenkins-infra/jenkins.io/edit/master/content//blog/2019/06/2019-06-21-performance-testing-jenkins.adoc" title="Edit /blog/2019/06/2019-06-21-performance-testing-jenkins.adoc on GitHub">Improve this page</a>
|
<a href="https://github.com/jenkins-infra/jenkins.io/commits/master/content//blog/2019/06/2019-06-21-performance-testing-jenkins.adoc" title="View /blog/2019/06/2019-06-21-performance-testing-jenkins.adoc history on GitHub">Page history</a>
</p>
<div class="license-box">
<div id="creativecommons">
<a href="https://creativecommons.org/licenses/by-sa/4.0/">
<p>
<img alt="Creative Commons Attribution-ShareAlike license" src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
</p>
</a>
<p>
The content driving this site is licensed under the Creative
Commons Attribution-ShareAlike 4.0 license.
</p>
</div>
</div>
</div>
<div class="links col-md-8">
<div class="container">
<div class="row">
<div class="area col-md-3">
<div class="div-mar">
<h5>Resources</h5>
<ul class="resources">
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/download">
Downloads
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/node">
Blog
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/doc">
Documentation
</a>
</li>
<li>
<a href="https://plugins.jenkins.io/">
Plugins
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/security">
Security
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/participate">
Contributing
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Project</h5>
<ul class="project">
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/project">
Structure and governance
</a>
</li>
<li>
<a href="https://issues.jenkins-ci.org">
Issue tracker
</a>
</li>
<li>
<a href="https://wiki.jenkins.io">
Wiki
</a>
</li>
<li>
<a href="https://github.com/jenkinsci">
GitHub
</a>
</li>
<li>
<a href="https://ci.jenkins.io">
Jenkins on Jenkins
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Community</h5>
<ul class="community">
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/events">
Events
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/mailing-lists">
Mailing lists
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/chat">
Chats
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/sigs">
Special Interest Groups
</a>
</li>
<li>
<a href="https://twitter.com/jenkinsci">
Twitter
</a>
</li>
<li>
<a href="https://reddit.com/r/jenkinsci">
Reddit
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Other</h5>
<ul class="other">
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/conduct">
Code of Conduct
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/press">
Press information
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/merchandise">
Merchandise
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/artwork">
Artwork
</a>
</li>
<li>
<a href="https://zbynek.github.io/jenkins.io/order-syntax/awards">
Awards
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
  
  $(function(){
    var $body = $(document.body);
    $(".nav-link.dropdown-toggle").on("mousedown", function(){
      $body.addClass("no-outline");
    })
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
</body>
</html>
